% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
\PassOptionsToPackage{dvipsnames,svgnames,x11names}{xcolor}
%
\documentclass[
  letterpaper,
  DIV=11,
  numbers=noendperiod]{scrartcl}

\usepackage{amsmath,amssymb}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
\usepackage{lmodern}
\ifPDFTeX\else  
    % xetex/luatex font selection
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\usepackage[right=1in,left=1in]{geometry}
\setlength{\emergencystretch}{3em} % prevent overfull lines
\setcounter{secnumdepth}{3}
% Make \paragraph and \subparagraph free-standing
\ifx\paragraph\undefined\else
  \let\oldparagraph\paragraph
  \renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
  \let\oldsubparagraph\subparagraph
  \renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{241,243,245}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.40,0.45,0.13}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\BuiltInTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\ExtensionTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.28,0.35,0.67}{#1}}
\newcommand{\ImportTok}[1]{\textcolor[rgb]{0.00,0.46,0.62}{#1}}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\NormalTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\RegionMarkerTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.07,0.07,0.07}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}

\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
% definitions for citeproc citations
\NewDocumentCommand\citeproctext{}{}
\NewDocumentCommand\citeproc{mm}{%
  \begingroup\def\citeproctext{#2}\cite{#1}\endgroup}
\makeatletter
 % allow citations to break across lines
 \let\@cite@ofmt\@firstofone
 % avoid brackets around text for \cite:
 \def\@biblabel#1{}
 \def\@cite#1#2{{#1\if@tempswa , #2\fi}}
\makeatother
\newlength{\cslhangindent}
\setlength{\cslhangindent}{1.5em}
\newlength{\csllabelwidth}
\setlength{\csllabelwidth}{3em}
\newenvironment{CSLReferences}[2] % #1 hanging-indent, #2 entry-spacing
 {\begin{list}{}{%
  \setlength{\itemindent}{0pt}
  \setlength{\leftmargin}{0pt}
  \setlength{\parsep}{0pt}
  % turn on hanging indent if param 1 is 1
  \ifodd #1
   \setlength{\leftmargin}{\cslhangindent}
   \setlength{\itemindent}{-1\cslhangindent}
  \fi
  % set entry spacing
  \setlength{\itemsep}{#2\baselineskip}}}
 {\end{list}}
\usepackage{calc}
\newcommand{\CSLBlock}[1]{\hfill\break#1\hfill\break}
\newcommand{\CSLLeftMargin}[1]{\parbox[t]{\csllabelwidth}{\strut#1\strut}}
\newcommand{\CSLRightInline}[1]{\parbox[t]{\linewidth - \csllabelwidth}{\strut#1\strut}}
\newcommand{\CSLIndent}[1]{\hspace{\cslhangindent}#1}

\usepackage{booktabs}
\usepackage{longtable}
\usepackage{array}
\usepackage{multirow}
\usepackage{wrapfig}
\usepackage{float}
\usepackage{colortbl}
\usepackage{pdflscape}
\usepackage{tabu}
\usepackage{threeparttable}
\usepackage{threeparttablex}
\usepackage[normalem]{ulem}
\usepackage{makecell}
\usepackage{xcolor}
\usepackage{tabularray}
\usepackage[normalem]{ulem}
\usepackage{graphicx}
\UseTblrLibrary{booktabs}
\UseTblrLibrary{siunitx}
\NewTableCommand{\tinytableDefineColor}[3]{\definecolor{#1}{#2}{#3}}
\newcommand{\tinytableTabularrayUnderline}[1]{\underline{#1}}
\newcommand{\tinytableTabularrayStrikeout}[1]{\sout{#1}}
\usepackage{wrapfig}
\usepackage{colortbl}
 \makeatletter
 \renewenvironment{table}%
   {\renewcommand\familydefault\sfdefault
    \@float{table}}
   {\end@float}
 \renewenvironment{figure}%
   {\renewcommand\familydefault\sfdefault
    \@float{figure}}
   {\end@float}
 \makeatother
\usepackage{changes}
\KOMAoption{captions}{tableheading}
\makeatletter
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\AtBeginDocument{%
\ifdefined\contentsname
  \renewcommand*\contentsname{Table of contents}
\else
  \newcommand\contentsname{Table of contents}
\fi
\ifdefined\listfigurename
  \renewcommand*\listfigurename{List of Figures}
\else
  \newcommand\listfigurename{List of Figures}
\fi
\ifdefined\listtablename
  \renewcommand*\listtablename{List of Tables}
\else
  \newcommand\listtablename{List of Tables}
\fi
\ifdefined\figurename
  \renewcommand*\figurename{Figure}
\else
  \newcommand\figurename{Figure}
\fi
\ifdefined\tablename
  \renewcommand*\tablename{Table}
\else
  \newcommand\tablename{Table}
\fi
}
\@ifpackageloaded{float}{}{\usepackage{float}}
\floatstyle{ruled}
\@ifundefined{c@chapter}{\newfloat{codelisting}{h}{lop}}{\newfloat{codelisting}{h}{lop}[chapter]}
\floatname{codelisting}{Listing}
\newcommand*\listoflistings{\listof{codelisting}{List of Listings}}
\makeatother
\makeatletter
\makeatother
\makeatletter
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\@ifpackageloaded{subcaption}{}{\usepackage{subcaption}}
\makeatother
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same} % disable monospaced font for URLs
\hypersetup{
  pdftitle={How Do Household Energy Transitions Work?},
  pdfauthor={Jill Baumgartner (Co-PI); Sam Harper (Co-PI); On behalf of the Beijing Household Energy Transitions Team},
  colorlinks=true,
  linkcolor={blue},
  filecolor={Maroon},
  citecolor={Blue},
  urlcolor={Blue},
  pdfcreator={LaTeX via pandoc}}

\title{How Do Household Energy Transitions Work?}
\author{Jill Baumgartner (Co-PI) \and Sam Harper (Co-PI) \and On behalf
of the Beijing Household Energy Transitions Team}
\date{2024-07-24}

\begin{document}
\maketitle
\renewcommand*\contentsname{Table of contents}
{
\hypersetup{linkcolor=}
\setcounter{tocdepth}{3}
\tableofcontents
}
\newpage

\section{Introduction}\label{introduction}

China is deploying an ambitious policy to transition up to 70\% of
households in northern China from residential coal heating to electric
or gas ``clean'' space heating, including a large-scale roll out across
rural and peri-urban Beijing, referred to in this document as China's
Coal Ban and Heat Pump (CBHP) subsidy policy. To meet this target the
Beijing municipal government announced a two-pronged program that
designates coal-restricted areas and simultaneously offers subsidies to
night-time electricity rates and for the purchase and installation of
electric-powered heat pumps to replace traditional coal-heating stoves.
The policy was piloted in 2015 and, starting in 2016, was rolled out on
a village-by-village basis. The variability in when the policy was
applied to each village allowed us to treat the roll-out of the program
as a quasi-randomized intervention and evaluate its impacts on air
quality and health. Household air pollution is a well-established risk
factor for adverse health outcomes over the entire lifecourse, yet there
is no consensus that clean energy interventions can improve these health
outcomes based on evidence from randomized trials (Lai et al. 2024).
Households may be differentially affected by the CBHP due to factors
such as financial constraints and user preferences, and there is
uncertainty about whether and how the policy may affect indoor and
outdoor air pollution, as well as heating behaviors and health outcomes.

First table:

\begin{table}
\centering
\begin{talltblr}[         %% tabularray outer open
caption={Test caption},
]                     %% tabularray outer close
{                     %% tabularray inner open
colspec={Q[]Q[]Q[]Q[]Q[]Q[]Q[]Q[]},
cell{1}{1}={c=1,}{halign=c,},
cell{1}{2}={c=3,}{halign=c,},
cell{1}{5}={c=4,}{halign=c,},
}                     %% tabularray inner close
\toprule
& Overall &  &  & Indoor &  &  &  \\ \cmidrule[lr]{1-1}\cmidrule[lr]{2-4}\cmidrule[lr]{5-8}
Sample & Wave 1 & Wave 2 & Wave 4 & Wave 1 & Wave 2 & Wave 3 & Wave 4 \\ \midrule %% TinyTableHeader
New recruitment & 977 &  196 &   68 &  0 & 300 &   0 &  52 \\
Wave 1 households & - &  866 &  780 & - &   0 &   0 &   0 \\
Wave 2 households & - & - &  162 & - & - & 246 & 248 \\
Total recruitment & 977 & 1062 & 1010 &  0 & 300 & 246 & 300 \\
\bottomrule
\end{talltblr}
\end{table}

Problem table:

Read in the data for Table 2:

Now insert the function:

And then make the table (see \textbf{?@tbl-table2}):

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Columns of interest}
\NormalTok{columns\_of\_interest }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"female"}\NormalTok{, }\StringTok{"csmoke"}\NormalTok{, }\StringTok{"asmoke"}\NormalTok{, }
  \StringTok{"bmi"}\NormalTok{, }\StringTok{"age\_health"}\NormalTok{, }\StringTok{"waist\_circ"}\NormalTok{)}

\CommentTok{\# Apply the function to the data set}
\NormalTok{result }\OtherTok{\textless{}{-}} \FunctionTok{process\_columns}\NormalTok{(ds, columns\_of\_interest)}

\NormalTok{t2 }\OtherTok{\textless{}{-}}\NormalTok{ result }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{char =} \FunctionTok{c}\NormalTok{(}
    \StringTok{"Female, n (\%)"}\NormalTok{, }
    \StringTok{"Current smoker, n (\%)"}\NormalTok{,}
    \StringTok{"Any smoke exposure, n (\%)"}\NormalTok{, }
    \StringTok{"Age in years, Mean (SD)"}\NormalTok{,}
    \StringTok{"BMI (kg/m2), Mean (SD)"}\NormalTok{, }
    \StringTok{"Waist circumference (cm), Mean (SD)"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{rename}\NormalTok{(}\StringTok{"Characteristic"} \OtherTok{=}\NormalTok{ char)}

\FunctionTok{colnames}\NormalTok{(t2) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"Characteristic"}\NormalTok{, }
  \StringTok{"Wave 1 (2018{-}19) N=1003"}\NormalTok{, }\StringTok{"Wave 2 (2019{-}20) N=1110"}\NormalTok{,}
  \StringTok{"Wave 4 (2021{-}22) N=1028"}\NormalTok{, }\StringTok{"Statistic"}\NormalTok{, }\StringTok{"p{-}value"}\NormalTok{)}

\FunctionTok{tt}\NormalTok{(t2, }\AttributeTok{caption =} \StringTok{"Example table.}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{label\{tbl{-}table2\}"}\NormalTok{,}
   \AttributeTok{width =} \FunctionTok{c}\NormalTok{(.}\DecValTok{4}\NormalTok{, .}\DecValTok{15}\NormalTok{, .}\DecValTok{15}\NormalTok{, .}\DecValTok{15}\NormalTok{, .}\DecValTok{1}\NormalTok{, .}\DecValTok{1}\NormalTok{),}
   \AttributeTok{notes =} \FunctionTok{list}\NormalTok{(}\AttributeTok{a =} \FunctionTok{list}\NormalTok{(}\AttributeTok{i=}\DecValTok{0}\NormalTok{, }\AttributeTok{j=}\DecValTok{5}\NormalTok{,}
     \AttributeTok{text =} \StringTok{"Blah."}\NormalTok{))) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{theme\_tt}\NormalTok{(}\StringTok{"multipage"}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{group\_tt}\NormalTok{(}
    \AttributeTok{j =} \FunctionTok{list}\NormalTok{(}
      \StringTok{" "} \OtherTok{=} \DecValTok{1}\NormalTok{,}
      \StringTok{"Estimates"} \OtherTok{=} \DecValTok{2}\SpecialCharTok{:}\DecValTok{4}\NormalTok{,}
      \StringTok{"Test for Equality"} \OtherTok{=} \DecValTok{5}\SpecialCharTok{:}\DecValTok{6}\NormalTok{)) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{format\_tt}\NormalTok{(}\AttributeTok{escape =} \ConstantTok{TRUE}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{style\_tt}\NormalTok{(}\AttributeTok{j =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{4}\NormalTok{, }\AttributeTok{align =} \StringTok{"llll"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\phantomsection\label{refs}
\begin{CSLReferences}{1}{1}
\bibitem[\citeproctext]{ref-lai2024}
Lai PS, Lam NL, Gallery B, Lee AG, Adair-Rohani H, Alexander D, et al.
2024. Household {Air Pollution Interventions} to {Improve Health} in
{Low-} and {Middle-Income Countries}: {An Official American Thoracic
Society Research Statement}. American Journal of Respiratory and
Critical Care Medicine 209:909--927;
doi:\href{https://doi.org/10.1164/rccm.202402-0398ST}{10.1164/rccm.202402-0398ST}.

\end{CSLReferences}



\end{document}
